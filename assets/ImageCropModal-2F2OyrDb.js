import{r as R,p,j as m,X as N,C as X}from"./index-X9c5RyGv.js";const k={x:0,y:0,width:0,height:0,unit:"px"},M=(s,e,t)=>Math.min(Math.max(s,e),t),Y=(...s)=>s.filter(e=>e&&typeof e=="string").join(" "),H=(s,e)=>s===e||s.width===e.width&&s.height===e.height&&s.x===e.x&&s.y===e.y&&s.unit===e.unit;function _(s,e,t,r){const n=f(s,t,r);return s.width&&(n.height=n.width/e),s.height&&(n.width=n.height*e),n.y+n.height>r&&(n.height=r-n.y,n.width=n.height*e),n.x+n.width>t&&(n.width=t-n.x,n.height=n.width/e),s.unit==="%"?b(n,t,r):n}function P(s,e,t){const r=f(s,e,t);return r.x=(e-r.width)/2,r.y=(t-r.height)/2,s.unit==="%"?b(r,e,t):r}function b(s,e,t){return s.unit==="%"?{...k,...s,unit:"%"}:{unit:"%",x:s.x?s.x/e*100:0,y:s.y?s.y/t*100:0,width:s.width?s.width/e*100:0,height:s.height?s.height/t*100:0}}function f(s,e,t){return s.unit?s.unit==="px"?{...k,...s,unit:"px"}:{unit:"px",x:s.x?s.x*e/100:0,y:s.y?s.y*t/100:0,width:s.width?s.width*e/100:0,height:s.height?s.height*t/100:0}:{...k,...s,unit:"px"}}function I(s,e,t,r,n,i=0,o=0,w=r,h=n){const a={...s};let l=Math.min(i,r),c=Math.min(o,n),g=Math.min(w,r),d=Math.min(h,n);e&&(e>1?(l=o?o*e:l,c=l/e,g=w*e):(c=i?i/e:c,l=c*e,d=h/e)),a.y<0&&(a.height=Math.max(a.height+a.y,c),a.y=0),a.x<0&&(a.width=Math.max(a.width+a.x,l),a.x=0);const u=r-(a.x+a.width);u<0&&(a.x=Math.min(a.x,r-l),a.width+=u);const y=n-(a.y+a.height);if(y<0&&(a.y=Math.min(a.y,n-c),a.height+=y),a.width<l&&((t==="sw"||t=="nw")&&(a.x-=l-a.width),a.width=l),a.height<c&&((t==="nw"||t=="ne")&&(a.y-=c-a.height),a.height=c),a.width>g&&((t==="sw"||t=="nw")&&(a.x-=g-a.width),a.width=g),a.height>d&&((t==="nw"||t=="ne")&&(a.y-=d-a.height),a.height=d),e){const D=a.width/a.height;if(D<e){const C=Math.max(a.width/e,c);(t==="nw"||t=="ne")&&(a.y-=C-a.height),a.height=C}else if(D>e){const C=Math.max(a.height*e,l);(t==="sw"||t=="nw")&&(a.x-=C-a.width),a.width=C}}return a}function S(s,e,t,r){const n={...s};return e==="ArrowLeft"?r==="nw"?(n.x-=t,n.y-=t,n.width+=t,n.height+=t):r==="w"?(n.x-=t,n.width+=t):r==="sw"?(n.x-=t,n.width+=t,n.height+=t):r==="ne"?(n.y+=t,n.width-=t,n.height-=t):r==="e"?n.width-=t:r==="se"&&(n.width-=t,n.height-=t):e==="ArrowRight"&&(r==="nw"?(n.x+=t,n.y+=t,n.width-=t,n.height-=t):r==="w"?(n.x+=t,n.width-=t):r==="sw"?(n.x+=t,n.width-=t,n.height-=t):r==="ne"?(n.y-=t,n.width+=t,n.height+=t):r==="e"?n.width+=t:r==="se"&&(n.width+=t,n.height+=t)),e==="ArrowUp"?r==="nw"?(n.x-=t,n.y-=t,n.width+=t,n.height+=t):r==="n"?(n.y-=t,n.height+=t):r==="ne"?(n.y-=t,n.width+=t,n.height+=t):r==="sw"?(n.x+=t,n.width-=t,n.height-=t):r==="s"?n.height-=t:r==="se"&&(n.width-=t,n.height-=t):e==="ArrowDown"&&(r==="nw"?(n.x+=t,n.y+=t,n.width-=t,n.height-=t):r==="n"?(n.y+=t,n.height-=t):r==="ne"?(n.y+=t,n.width-=t,n.height-=t):r==="sw"?(n.x-=t,n.width+=t,n.height+=t):r==="s"?n.height+=t:r==="se"&&(n.width+=t,n.height+=t)),n}const E={capture:!0,passive:!1};let $=0;const v=class x extends R.PureComponent{constructor(){super(...arguments),this.docMoveBound=!1,this.mouseDownOnCrop=!1,this.dragStarted=!1,this.evData={startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0},this.componentRef=R.createRef(),this.mediaRef=R.createRef(),this.initChangeCalled=!1,this.instanceId=`rc-${$++}`,this.state={cropIsActive:!1,newCropIsBeingDrawn:!1},this.onCropPointerDown=e=>{const{crop:t,disabled:r}=this.props,n=this.getBox();if(!t)return;const i=f(t,n.width,n.height);if(r)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const o=e.target.dataset.ord,w=!!o;let h=e.clientX,a=e.clientY,l=i.x,c=i.y;if(o){const g=e.clientX-n.x,d=e.clientY-n.y;let u=0,y=0;o==="ne"||o=="e"?(u=g-(i.x+i.width),y=d-i.y,l=i.x,c=i.y+i.height):o==="se"||o==="s"?(u=g-(i.x+i.width),y=d-(i.y+i.height),l=i.x,c=i.y):o==="sw"||o=="w"?(u=g-i.x,y=d-(i.y+i.height),l=i.x+i.width,c=i.y):(o==="nw"||o=="n")&&(u=g-i.x,y=d-i.y,l=i.x+i.width,c=i.y+i.height),h=l+n.x+u,a=c+n.y+y}this.evData={startClientX:h,startClientY:a,startCropX:l,startCropY:c,clientX:e.clientX,clientY:e.clientY,isResize:w,ord:o},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})},this.onComponentPointerDown=e=>{const{crop:t,disabled:r,locked:n,keepSelection:i,onChange:o}=this.props,w=this.getBox();if(r||n||i&&t)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const h=e.clientX-w.x,a=e.clientY-w.y,l={unit:"px",x:h,y:a,width:0,height:0};this.evData={startClientX:e.clientX,startClientY:e.clientY,startCropX:h,startCropY:a,clientX:e.clientX,clientY:e.clientY,isResize:!0},this.mouseDownOnCrop=!0,o(f(l,w.width,w.height),b(l,w.width,w.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})},this.onDocPointerMove=e=>{const{crop:t,disabled:r,onChange:n,onDragStart:i}=this.props,o=this.getBox();if(r||!t||!this.mouseDownOnCrop)return;e.cancelable&&e.preventDefault(),this.dragStarted||(this.dragStarted=!0,i&&i(e));const{evData:w}=this;w.clientX=e.clientX,w.clientY=e.clientY;let h;w.isResize?h=this.resizeCrop():h=this.dragCrop(),H(t,h)||n(f(h,o.width,o.height),b(h,o.width,o.height))},this.onComponentKeyDown=e=>{const{crop:t,disabled:r,onChange:n,onComplete:i}=this.props;if(r)return;const o=e.key;let w=!1;if(!t)return;const h=this.getBox(),a=this.makePixelCrop(h),l=(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?x.nudgeStepLarge:e.shiftKey?x.nudgeStepMedium:x.nudgeStep;if(o==="ArrowLeft"?(a.x-=l,w=!0):o==="ArrowRight"?(a.x+=l,w=!0):o==="ArrowUp"?(a.y-=l,w=!0):o==="ArrowDown"&&(a.y+=l,w=!0),w){e.cancelable&&e.preventDefault(),a.x=M(a.x,0,h.width-a.width),a.y=M(a.y,0,h.height-a.height);const c=f(a,h.width,h.height),g=b(a,h.width,h.height);n(c,g),i&&i(c,g)}},this.onHandlerKeyDown=(e,t)=>{const{aspect:r=0,crop:n,disabled:i,minWidth:o=0,minHeight:w=0,maxWidth:h,maxHeight:a,onChange:l,onComplete:c}=this.props,g=this.getBox();if(i||!n)return;if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")e.stopPropagation(),e.preventDefault();else return;const d=(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?x.nudgeStepLarge:e.shiftKey?x.nudgeStepMedium:x.nudgeStep,u=f(n,g.width,g.height),y=S(u,e.key,d,t),D=I(y,r,t,g.width,g.height,o,w,h,a);if(!H(n,D)){const C=b(D,g.width,g.height);l(D,C),c&&c(D,C)}},this.onDocPointerDone=e=>{const{crop:t,disabled:r,onComplete:n,onDragEnd:i}=this.props,o=this.getBox();this.unbindDocMove(),!(r||!t)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,i&&i(e),n&&n(f(t,o.width,o.height),b(t,o.width,o.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))},this.onDragFocus=()=>{var e;(e=this.componentRef.current)==null||e.scrollTo(0,0)}}get document(){return document}getBox(){const e=this.mediaRef.current;if(!e)return{x:0,y:0,width:0,height:0};const{x:t,y:r,width:n,height:i}=e.getBoundingClientRect();return{x:t,y:r,width:n,height:i}}componentDidUpdate(e){const{crop:t,onComplete:r}=this.props;if(r&&!e.crop&&t){const{width:n,height:i}=this.getBox();n&&i&&r(f(t,n,i),b(t,n,i))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,E),this.document.addEventListener("pointerup",this.onDocPointerDone,E),this.document.addEventListener("pointercancel",this.onDocPointerDone,E),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,E),this.document.removeEventListener("pointerup",this.onDocPointerDone,E),this.document.removeEventListener("pointercancel",this.onDocPointerDone,E),this.docMoveBound=!1)}getCropStyle(){const{crop:e}=this.props;if(e)return{top:`${e.y}${e.unit}`,left:`${e.x}${e.unit}`,width:`${e.width}${e.unit}`,height:`${e.height}${e.unit}`}}dragCrop(){const{evData:e}=this,t=this.getBox(),r=this.makePixelCrop(t),n=e.clientX-e.startClientX,i=e.clientY-e.startClientY;return r.x=M(e.startCropX+n,0,t.width-r.width),r.y=M(e.startCropY+i,0,t.height-r.height),r}getPointRegion(e,t,r,n){const{evData:i}=this,o=i.clientX-e.x,w=i.clientY-e.y;let h;n&&t?h=t==="nw"||t==="n"||t==="ne":h=w<i.startCropY;let a;return r&&t?a=t==="nw"||t==="w"||t==="sw":a=o<i.startCropX,a?h?"nw":"sw":h?"ne":"se"}resolveMinDimensions(e,t,r=0,n=0){const i=Math.min(r,e.width),o=Math.min(n,e.height);return!t||!i&&!o?[i,o]:t>1?i?[i,i/t]:[o*t,o]:o?[o*t,o]:[i,i/t]}resizeCrop(){const{evData:e}=this,{aspect:t=0,maxWidth:r,maxHeight:n}=this.props,i=this.getBox(),[o,w]=this.resolveMinDimensions(i,t,this.props.minWidth,this.props.minHeight);let h=this.makePixelCrop(i);const a=this.getPointRegion(i,e.ord,o,w),l=e.ord||a;let c=e.clientX-e.startClientX,g=e.clientY-e.startClientY;(o&&l==="nw"||l==="w"||l==="sw")&&(c=Math.min(c,-o)),(w&&l==="nw"||l==="n"||l==="ne")&&(g=Math.min(g,-w));const d={unit:"px",x:0,y:0,width:0,height:0};a==="ne"?(d.x=e.startCropX,d.width=c,t?(d.height=d.width/t,d.y=e.startCropY-d.height):(d.height=Math.abs(g),d.y=e.startCropY-d.height)):a==="se"?(d.x=e.startCropX,d.y=e.startCropY,d.width=c,t?d.height=d.width/t:d.height=g):a==="sw"?(d.x=e.startCropX+c,d.y=e.startCropY,d.width=Math.abs(c),t?d.height=d.width/t:d.height=g):a==="nw"&&(d.x=e.startCropX+c,d.width=Math.abs(c),t?(d.height=d.width/t,d.y=e.startCropY-d.height):(d.height=Math.abs(g),d.y=e.startCropY+g));const u=I(d,t,a,i.width,i.height,o,w,r,n);return t||x.xyOrds.indexOf(l)>-1?h=u:x.xOrds.indexOf(l)>-1?(h.x=u.x,h.width=u.width):x.yOrds.indexOf(l)>-1&&(h.y=u.y,h.height=u.height),h.x=M(h.x,0,i.width-h.width),h.y=M(h.y,0,i.height-h.height),h}renderCropSelection(){const{ariaLabels:e=x.defaultProps.ariaLabels,disabled:t,locked:r,renderSelectionAddon:n,ruleOfThirds:i,crop:o}=this.props,w=this.getCropStyle();if(o)return p.createElement("div",{style:w,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":e.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!t&&!r&&p.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},p.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),p.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),p.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),p.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":e.nwDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"nw"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":e.nDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"n"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":e.neDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"ne"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":e.eDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"e"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":e.seDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"se"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":e.sDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"s"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":e.swDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"sw"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":e.wDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"w"),role:"button"})),n&&p.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:h=>h.stopPropagation()},n(this.state)),i&&p.createElement(p.Fragment,null,p.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),p.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(e){const t={...k,...this.props.crop||{}};return f(t,e.width,e.height)}render(){const{aspect:e,children:t,circularCrop:r,className:n,crop:i,disabled:o,locked:w,style:h,ruleOfThirds:a}=this.props,{cropIsActive:l,newCropIsBeingDrawn:c}=this.state,g=i?this.renderCropSelection():null,d=Y("ReactCrop",n,l&&"ReactCrop--active",o&&"ReactCrop--disabled",w&&"ReactCrop--locked",c&&"ReactCrop--new-crop",i&&e&&"ReactCrop--fixed-aspect",i&&r&&"ReactCrop--circular-crop",i&&a&&"ReactCrop--rule-of-thirds",!this.dragStarted&&i&&!i.width&&!i.height&&"ReactCrop--invisible-crop",r&&"ReactCrop--no-animate");return p.createElement("div",{ref:this.componentRef,className:d,style:h},p.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),i?p.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},p.createElement("defs",null,p.createElement("mask",{id:`hole-${this.instanceId}`},p.createElement("rect",{width:"100%",height:"100%",fill:"white"}),r?p.createElement("ellipse",{cx:`${i.x+i.width/2}${i.unit}`,cy:`${i.y+i.height/2}${i.unit}`,rx:`${i.width/2}${i.unit}`,ry:`${i.height/2}${i.unit}`,fill:"black"}):p.createElement("rect",{x:`${i.x}${i.unit}`,y:`${i.y}${i.unit}`,width:`${i.width}${i.unit}`,height:`${i.height}${i.unit}`,fill:"black"}))),p.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,g)}};v.xOrds=["e","w"],v.yOrds=["n","s"],v.xyOrds=["nw","ne","se","sw"],v.nudgeStep=1,v.nudgeStepMedium=10,v.nudgeStepLarge=100,v.defaultProps={ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}};let K=v;function B(s,e){const t=document.createElement("canvas"),r=s.naturalWidth/s.width,n=s.naturalHeight/s.height;t.width=Math.floor(e.width*r),t.height=Math.floor(e.height*n);const i=t.getContext("2d");return i?(i.drawImage(s,e.x*r,e.y*n,e.width*r,e.height*n,0,0,t.width,t.height),new Promise((o,w)=>{t.toBlob(h=>{if(!h){console.error("Canvas is empty"),w(new Error("Canvas is empty"));return}o(h)},"image/png")})):Promise.resolve(null)}const A=({imageSrc:s,onConfirm:e,onCancel:t,t:r})=>{const[n,i]=R.useState(),[o,w]=R.useState(),h=R.useRef(null);R.useEffect(()=>{const c="https://cdn.jsdelivr.net/npm/react-image-crop@11.0.5/dist/ReactCrop.min.css",g="react-image-crop-styles";if(document.getElementById(g))return;const d=document.createElement("link");return d.id=g,d.rel="stylesheet",d.href=c,document.head.appendChild(d),()=>{const u=document.getElementById(g);u&&document.head.removeChild(u)}},[]);function a(c){const{width:g,height:d}=c.currentTarget,u=P(_({unit:"%",width:50},1,g,d),g,d);i(u)}const l=async()=>{if(o!=null&&o.width&&(o!=null&&o.height)&&h.current)try{const c=await B(h.current,o);c?e(c):alert("Could not crop image.")}catch(c){console.error(c),alert("An error occurred while cropping the image.")}};return m.jsx("div",{className:"fixed inset-0 bg-black/80 flex flex-col items-center justify-center z-50 p-4",children:m.jsxs("div",{className:"bg-white border border-brand-gray-light rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 md:p-8 relative flex flex-col",children:[m.jsx("h2",{className:"text-2xl font-bold text-brand-primary mb-4 text-center border-b border-brand-primary/20 pb-3",children:r("cropTitle")}),m.jsx("p",{className:"text-brand-gray mb-6 text-center",children:r("cropDescription")}),m.jsx("div",{className:"flex-grow flex items-center justify-center mb-6",children:m.jsx(K,{crop:n,onChange:(c,g)=>i(g),onComplete:c=>w(c),aspect:1,minWidth:50,minHeight:50,children:m.jsx("img",{ref:h,alt:"Crop me",src:s,onLoad:a,className:"max-w-full max-h-[50vh] object-contain"})})}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[m.jsxs("button",{onClick:t,className:"w-full sm:w-auto bg-white text-brand-gray font-semibold py-3 px-8 rounded-lg hover:bg-brand-light-dark transition-colors border-2 border-brand-gray-light flex items-center justify-center gap-2",children:[m.jsx(N,{className:"w-6 h-6"}),r("cropCancel")]}),m.jsxs("button",{onClick:l,disabled:!(o!=null&&o.width)||!(o!=null&&o.height),className:"w-full sm:w-auto bg-brand-primary text-white font-semibold py-3 px-8 rounded-lg hover:bg-brand-primary-hover transition-colors shadow-sm hover:shadow-md flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[m.jsx(X,{className:"w-6 h-6"}),r("cropConfirm")]})]})]})})};export{A as default};
